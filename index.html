<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống Ôn tập Công nghệ 11</title>
    <style>
        :root { --p: #2563eb; --s: #16a34a; --e: #dc2626; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 10px; margin: 0; }
        .timer-bar { position: fixed; top: 0; left: 0; width: 100%; background: #1e293b; color: #fbbf24; text-align: center; padding: 12px 0; font-size: 1.3rem; font-weight: bold; z-index: 1000; }
        .container { max-width: 850px; margin: 80px auto 40px; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .section-header { background: #eff6ff; color: var(--p); padding: 15px; border-radius: 8px; margin: 30px 0 20px; border-left: 6px solid var(--p); font-size: 1.2rem; font-weight: bold; }
        .q-box { margin-bottom: 30px; padding: 20px; border: 1px solid #e2e8f0; border-radius: 10px; }
        .opt { display: flex; align-items: center; padding: 12px; border: 1px solid #f1f5f9; margin: 8px 0; border-radius: 6px; cursor: pointer; }
        input { margin-right: 15px; transform: scale(1.3); }
        .btn { width: 100%; padding: 20px; background: var(--p); color: white; border: none; border-radius: 10px; font-size: 1.3rem; font-weight: bold; cursor: pointer; }
        
        /* Giao diện xem lại kết quả */
        .res-area { display: none; }
        .score-card { text-align: center; padding: 30px; background: #f0fdf4; border: 2px solid var(--s); border-radius: 15px; margin-bottom: 30px; }
        .review-q-item { background: #fff; border: 1px solid #e2e8f0; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .review-opt { padding: 8px 12px; margin: 5px 0; border-radius: 5px; border: 1px solid #eee; font-size: 0.95rem; }
        .opt-correct { background: #dcfce7; border-color: var(--s); color: #166534; font-weight: bold; }
        .opt-wrong { background: #fee2e2; border-color: var(--e); color: #991b1b; text-decoration: line-through; }
        .status-label { font-weight: bold; text-transform: uppercase; font-size: 0.8rem; margin-bottom: 5px; display: block; }
    </style>
</head>
<body>

<div class="timer-bar" id="timer">THỜI GIAN CÒN LẠI: 15:00</div>

<div class="container">
    <div id="quiz-ui">
        <h1 style="text-align:center">BÀI KIỂM TRA CÔNG NGHỆ 11</h1>
        <div id="content"></div>
        <button class="btn" onclick="grade()">NỘP BÀI KIỂM TRA</button>
    </div>

    <div id="res-ui" class="res-area">
        <div class="score-card">
            <h2>KẾT QUẢ BÀI LÀM</h2>
            <div style="font-size: 3.5rem; color: var(--p); font-weight: 800;" id="score-val">0/10</div>
            <p id="stats-val"></p>
            <button onclick="location.reload()" style="padding:8px 20px; cursor:pointer">Làm đề mới</button>
        </div>
        <h3>CHI TIẾT BÀI LÀM:</h3>
        <div id="review-list"></div>
    </div>
</div>

<script>
// Dữ liệu mẫu (Bạn hãy chèn đầy đủ danh sách đã có của bạn vào đây)
const BANK_A = [
    {q: "Vai trò của cơ khí chế tạo trong ngành giao thông vận tải được thể hiện qua sản phẩm nào?", a: ["Máy chụp cộng hưởng từ (MRI)", "Hệ thống tưới tiêu tự động", "Động cơ ô tô, xe máy", "Máy xay xát lúa gạo"], c: "Mg=="},
    {q: "Trong một dây chuyền sản xuất ô tô, ai là người trực tiếp lắp đặt động cơ vào khung xe?", a: ["Công nhân lắp ráp cơ khí", "Giám đốc nhà máy", "Kỹ sư thiết kế kiểu dáng xe", "Nhân viên bảo vệ nhà máy"], c: "MA=="}
    // ... Thêm tiếp các câu khác
];

const BANK_B = [
    {q: "Gia công cơ khí là gì?", a: ["là quá trình chế tạo sản phẩm cơ khí", "là quá trình nghiên cứu, thiết kế", "là giai đoạn cuối cùng", "là công việc chăm sóc"], c: "MA=="}
    // ... Thêm tiếp các câu khác
];

const BANK_P2 = [
    {q: "Các phương pháp gia công cơ khí không phoi bao gồm:", a: ["Đúc", "Tiện", "Rèn", "Hàn"], c: "WzAsIDIsIDNd"}
];

let examData = [];
let timerVal = 15 * 60;
let countdown;

function startTimer() {
    countdown = setInterval(() => {
        timerVal--;
        let m = Math.floor(timerVal/60), s = timerVal%60;
        document.getElementById('timer').innerText = `THỜI GIAN CÒN LẠI: ${m}:${s<10?'0':''}${s}`;
        if(timerVal <= 0) { clearInterval(countdown); grade(); }
    }, 1000);
}

function init() {
    const sA = BANK_A.sort(() => 0.5 - Math.random()).slice(0, 6);
    const sB = BANK_B.sort(() => 0.5 - Math.random()).slice(0, 6);
    const sP2 = BANK_P2.sort(() => 0.5 - Math.random()).slice(0, 4);

    examData = [...sA, ...sB, ...sP2].map(item => {
        const correctRaw = JSON.parse(atob(item.c));
        const isMulti = Array.isArray(correctRaw);
        let opts = item.a.map((txt, i) => ({ txt, isC: isM = isMulti ? correctRaw.includes(i) : i === correctRaw }));
        opts.sort(() => 0.5 - Math.random());
        return { q: item.q, type: isMulti?'multi':'single', options: opts };
    });

    let html = '';
    examData.forEach((q, i) => {
        if(i===0) html += `<div class="section-header">PHẦN 1: 1 ĐÁP ÁN ĐÚNG</div>`;
        if(i===12) html += `<div class="section-header">PHẦN 2: NHIỀU PHƯƠNG ÁN ĐÚNG</div>`;
        html += `<div class="q-box">
            <p><strong>Câu ${i+1}:</strong> ${q.q}</p>
            ${q.options.map((o, oi) => `<label class="opt"><input type="${q.type==='single'?'radio':'checkbox'}" name="q${i}" value="${oi}">${o.txt}</label>`).join('')}
        </div>`;
    });
    document.getElementById('content').innerHTML = html;
    startTimer();
}

function grade() {
    clearInterval(countdown);
    document.getElementById('timer').style.display = 'none';
    let correctTotal = 0;
    let reviewHtml = '';

    examData.forEach((q, i) => {
        const selected = Array.from(document.querySelectorAll(`input[name="q${i}"]:checked`)).map(e => parseInt(e.value));
        const correctIndices = q.options.map((o, oi) => o.isC ? oi : null).filter(v => v !== null);
        
        let isRight = (q.type === 'single') 
            ? (selected.length === 1 && q.options[selected[0]].isC)
            : (JSON.stringify(selected.sort()) === JSON.stringify(correctIndices.sort()));

        if(isRight) correctTotal++;

        reviewHtml += `<div class="review-q-item">
            <span class="status-label" style="color:${isRight? 'var(--s)':'var(--e)'}">${isRight?'✅ Chính xác':'❌ Chưa chính xác'}</span>
            <p><strong>Câu ${i+1}: ${q.q}</strong></p>
            <div class="review-opts">
                ${q.options.map((o, oi) => {
                    let styleClass = '';
                    if (o.isC) styleClass = 'opt-correct'; // Đáp án đúng luôn màu xanh
                    else if (selected.includes(oi) && !o.isC) styleClass = 'opt-wrong'; // Chọn sai thì màu đỏ
                    
                    return `<div class="review-opt ${styleClass}">
                        ${o.isC ? '● ' : '○ '} ${o.txt} 
                        ${o.isC ? ' (Đáp án đúng)' : ''}
                        ${(selected.includes(oi) && !o.isC) ? ' (Bạn đã chọn sai)' : ''}
                    </div>`;
                }).join('')}
            </div>
        </div>`;
    });

    document.getElementById('quiz-ui').style.display = 'none';
    document.getElementById('res-ui').style.display = 'block';
    document.getElementById('score-val').innerText = ((correctTotal/16)*10).toFixed(1) + "/10";
    document.getElementById('stats-val').innerText = `Đúng ${correctTotal}/16 câu.`;
    document.getElementById('review-list').innerHTML = reviewHtml;
    window.scrollTo(0,0);
}

window.onload = init;
</script>
</body>
</html>
