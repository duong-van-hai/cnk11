<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiểm tra Công nghệ 11</title>
    <style>
        :root { --p: #2563eb; --s: #16a34a; --e: #dc2626; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 10px; margin: 0; }
        .timer-bar { position: fixed; top: 0; left: 0; width: 100%; background: #1e293b; color: #fbbf24; text-align: center; padding: 10px 0; font-size: 1.2rem; font-weight: bold; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .container { max-width: 800px; margin: 60px auto 20px; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .q-box { margin-bottom: 25px; padding: 15px; border: 1px solid #e2e8f0; border-radius: 8px; }
        .opt { display: flex; align-items: center; padding: 10px; border: 1px solid #f1f5f9; margin: 5px 0; border-radius: 5px; cursor: pointer; }
        .opt:hover { background: #f8fafc; }
        input { margin-right: 12px; transform: scale(1.2); }
        .btn { width: 100%; padding: 15px; background: var(--p); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; }
        .res-area { display: none; text-align: center; }
        .correct { color: var(--s); font-weight: bold; }
    </style>
</head>
<body>

<div class="timer-bar" id="timer">THỜI GIAN CÒN LẠI: 15:00</div>

<div class="container">
    <div id="quiz-ui">
        <h2 style="text-align:center">BÀI KIỂM TRA ĐỊNH KỲ</h2>
        <div id="content"></div>
        <button class="btn" onclick="grade()">NỘP BÀI</button>
    </div>

    <div id="res-ui" class="res-area">
        <h1 id="score" style="font-size: 3rem; color: var(--p);">0/10</h1>
        <p id="stats"></p>
        <button onclick="location.reload()" style="padding:10px 20px; cursor:pointer">Làm đề mới</button>
        <div id="review" style="text-align:left; margin-top:20px; border-top:1px solid #eee"></div>
    </div>
</div>

<script>
// DỮ LIỆU GỐC TỪ FILE (ĐÃ MÃ HÓA ĐÁP ÁN)
const DATA_A = [
    {q: "Vai trò của cơ khí chế tạo trong ngành giao thông vận tải được thể hiện qua sản phẩm nào?", a: ["Máy chụp cộng hưởng từ (MRI)", "Hệ thống tưới tiêu tự động", "Động cơ ô tô, xe máy", "Máy xay xát lúa gạo"], c: "Mg=="},
    {q: "Trong một dây chuyền sản xuất ô tô, ai là người trực tiếp lắp đặt động cơ vào khung xe?", a: ["Công nhân lắp ráp cơ khí", "Giám đốc nhà máy", "Kỹ sư thiết kế kiểu dáng xe", "Nhân viên bảo vệ nhà máy"], c: "MA=="},
    {q: "Một trong những tính chất hoá học của vật liệu cơ khí là", a: ["tính cứng", "tính dẫn điện", "tính dẫn nhiệt", "tính chịu ăn mòn"], c: "Mw=="},
    {q: "Tính chất nào sau đây đặc trưng cho khả năng chống lại biến dạng dẻo hay phá hủy của kim loại dưới tác dụng của ngoại lực?", a: ["Tính dẫn nhiệt", "Tính đúc", "Độ bền (tính bền)", "Khối lượng riêng"], c: "Mg=="},
    {q: "Vật liệu nào có thể ghi nhớ được hình dạng ban đầu của nó?", a: ["Vật liệu có cơ tính biến thiên", "Nano", "Hợp kim nhớ hình", "Vật liệu kim loại và hợp kim"], c: "Mg=="},
    {q: "Phương pháp nào sau đây thuộc nhóm “Gia công có phoi” (gia công cắt gọt)?", a: ["Tiện", "Đúc", "Rèn", "Hàn"], c: "MA=="},
    {q: "Ưu điểm của công nghệ chế tạo phôi bằng phương pháp hàn?", a: ["Mối hàn kém bền", "Mối hàn hở", "Dễ cong vênh", "Tiết kiệm kim loại"], c: "Mw=="},
    {q: "Trên máy tiện vạn năng, chi tiết gắn dao khi tiện là", a: ["mâm cặp", "ụ động", "bàn gá dao", "hộp tốc độ"], c: "Mg=="},
    {q: "Sắp xếp các giai đoạn sau đúng với trình tự của quá trình sản xuất cơ khí?", a: ["Chế tạo phôi -> Gia công -> xử lí và bảo vệ -> lắp ráp -> đóng gói", "Gia công -> chế tạo phôi -> kiểm tra -> lắp ráp -> đóng gói", "Gia công -> chế tạo phôi -> lắp ráp -> kiểm tra -> đóng gói", "Chế tạo phôi -> Gia công -> lắp ráp -> kiểm tra -> đóng gói"], c: "MA=="},
    {q: "Bước “Xử lý và bảo vệ bề mặt” bao gồm các hoạt động nào sau đây?", a: ["Tiện, phay, bào, khoan", "Đúc, rèn, dập", "Sơn, mạ, phủ hóa chất chống ăn mòn", "Lắp ráp bu lông, đai ốc"], c: "Mg=="},
    {q: "Robot công nghiệp là thiết bị tự động có khả năng gì nổi bật nhất?", a: ["Tự động suy nghĩ như con người", "Thực hiện các thao tác theo chương trình được lập trình sẵn", "Di chuyển với tốc độ ánh sáng", "Tự sửa chữa khi bị hỏng hóc"], c: "MQ=="},
    {q: "Một dây chuyền đóng gói thực phẩm tự động sử dụng robot để xếp thùng carton lên pallet. Đây là ứng dụng của robot trong công đoạn nào?", a: ["Gia công", "Lắp ráp", "Kiểm tra", "Vận chuyển và xếp dỡ"], c: "Mw=="}
];

const DATA_B = [
    {q: "Nghề nghiệp trong lĩnh vực cơ khí gắn với những công việc nào? Chọn đáp án đúng nhất", a: ["Thiết kế sản phẩm cơ khí; Gia công cơ khí; Bảo dưỡng thiết bị cơ khí", "Thiết kế sản phẩm cơ khí; Lắp ráp sản phẩm cơ khí; Bảo dưỡng thiết bị cơ khí", "Thiết kế sản phẩm cơ khí; Gia công cơ khí; Lắp ráp sản phẩm cơ khí; Bảo dưỡng và sửa chữa thiết bị cơ khí", "Thiết kế sản phẩm cơ khí; Lắp ráp sản phẩm cơ khí; Bảo dưỡng và sửa chữa thiết bị cơ khí"], c: "Mg=="},
    {q: "Nghề nghiệp trong lĩnh vực cơ khí không bao gồm công việc nào dưới đây?", a: ["Thiết kế sản phẩm cơ khí", "Gia công cơ khí", "Lắp ráp sản phẩm cơ khí", "Lên kế hoạch kinh doanh sản phẩm cơ khí"], c: "Mw=="},
    {q: "Gia công cơ khí là gì?", a: ["là quá trình chế tạo sản phẩm cơ khí", "là quá trình nghiên cứu, thiết kế tính toán kích thước", "là giai đoạn cuối cùng của quá trình sản xuất", "là công việc chăm sóc, thực hiện kiểm tra"], c: "MA=="},
    {q: "Phân loại theo công nghệ gia công gồm:", a: ["Gia công cơ khí không phoi và gia công cơ khí có phoi", "Gia công cơ khí không phoi và gia công cơ khí truyền thống", "Gia công cơ khí truyền thống và gia công cơ khí có phoi", "Gia công cơ khí truyền thống và gia công cơ khí hiện đại"], c: "MA=="},
    {q: "Gia công cơ khí không phoi là quá trình", a: ["Gia công bằng tia lửa điện", "Gia công mà có một lượng vật liệu bị cắt gọt bỏ đi", "Gia công mà khối lượng vật liệu vẫn được giữ nguyên", "Gia công bằng siêu âm"], c: "Mg=="},
    {q: "Gia công cơ khí có phoi là quá trình", a: ["Gia công bằng tia lửa điện", "Gia công mà có một lượng vật liệu bị cắt gọt bỏ đi", "Gia công mà khối lượng vật liệu vẫn được giữ nguyên", "Gia công bằng siêu âm"], c: "MQ=="}
    // ... Bạn có thể thêm tiếp các câu khác từ 11OT1B vào mảng này
];

const DATA_P2 = [
    {q: "Các phương pháp gia công không phoi bao gồm:", a: ["Đúc", "Tiện", "Rèn", "Hàn"], c: "WzAsIDIsIDNd"},
    {q: "Vật liệu kim loại màu gồm những loại nào?", a: ["Đồng", "Thép", "Nhôm", "Nhựa"], c: "WzAsIDJd"},
    {q: "Các tính chất của vật liệu cơ khí gồm:", a: ["Cơ học", "Vật lý", "Hóa học", "Tâm linh"], c: "WzAsIDEsIDJd"},
    {q: "Thông số cơ bản của quá trình cắt gọt:", a: ["Vận tốc cắt", "Lượng chạy dao", "Chiều sâu cắt", "Màu sắc dao"], c: "WzAsIDEsIDJd"}
];

let exam = [];
let t = 15 * 60;
let timer;

function startTimer() {
    timer = setInterval(() => {
        t--;
        let m = Math.floor(t/60), s = t%60;
        document.getElementById('timer').innerText = `THỜI GIAN CÒN LẠI: ${m}:${s<10?'0':''}${s}`;
        if(t<=0) { clearInterval(timer); grade(); }
    }, 1000);
}

function init() {
    // 6 câu A, 6 câu B, 4 câu P2 - Tuyệt đối không thay đổi tỉ lệ
    const sA = DATA_A.sort(() => 0.5-Math.random()).slice(0, 6);
    const sB = DATA_B.sort(() => 0.5-Math.random()).slice(0, 6);
    const sP2 = DATA_P2.sort(() => 0.5-Math.random()).slice(0, 4);

    exam = [...sA, ...sB, ...sP2].map(item => {
        const cDec = JSON.parse(atob(item.c));
        const isM = Array.isArray(cDec);
        let opts = item.a.map((txt, i) => ({ txt, isC: isM ? cDec.includes(i) : i === cDec }));
        opts.sort(() => 0.5 - Math.random()); // Trộn đáp án
        return { q: item.q, type: isM ? 'multi' : 'single', options: opts };
    });

    document.getElementById('content').innerHTML = exam.map((q, i) => `
        <div class="q-box">
            <p><strong>Câu ${i+1}:</strong> ${q.q}</p>
            ${q.options.map((o, oi) => `
                <label class="opt">
                    <input type="${q.type==='single'?'radio':'checkbox'}" name="q${i}" value="${oi}">
                    ${o.txt}
                </label>
            `).join('')}
        </div>
    `).join('');
    startTimer();
}

function grade() {
    clearInterval(timer);
    let correct = 0;
    let rev = '';
    exam.forEach((q, i) => {
        const sel = Array.from(document.querySelectorAll(`input[name="q${i}"]:checked`)).map(e => parseInt(e.value));
        const ans = q.options.map((o, oi) => o.isC ? oi : null).filter(v => v !== null);
        let ok = (q.type==='single') ? (sel.length===1 && q.options[sel[0]].isC) : (JSON.stringify(sel.sort())===JSON.stringify(ans.sort()));
        if(ok) correct++;
        rev += `<p>Câu ${i+1}: ${ok?'✅':'❌'} - Đáp án: <span class="correct">${ans.map(idx => q.options[idx].txt).join('; ')}</span></p>`;
    });
    document.getElementById('quiz-ui').style.display = 'none';
    document.getElementById('res-ui').style.display = 'block';
    document.getElementById('score').innerText = ((correct/16)*10).toFixed(1) + "/10";
    document.getElementById('stats').innerText = `Đúng ${correct}/16 câu`;
    document.getElementById('review').innerHTML = rev;
    window.scrollTo(0,0);
}

window.onload = init;
</script>
</body>
</html>
