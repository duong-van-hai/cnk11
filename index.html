<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Trắc Nghiệm Công Nghệ 11</title>
    <style>
        :root { --primary: #2563eb; --success: #16a34a; --error: #dc2626; --bg: #f1f5f9; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); padding: 20px; color: #1e293b; }
        .container { max-width: 850px; margin: auto; background: white; padding: 30px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .header { text-align: center; border-bottom: 2px solid #e2e8f0; margin-bottom: 25px; padding-bottom: 15px; }
        .section-header { background: #f8fafc; border-left: 4px solid var(--primary); padding: 10px 15px; margin: 25px 0 15px; font-weight: bold; color: var(--primary); }
        .question-item { margin-bottom: 20px; padding: 20px; border: 1px solid #e2e8f0; border-radius: 12px; background: #fff; }
        
        /* Style cho các option */
        .option-label { display: flex; align-items: center; padding: 12px; border: 1px solid #f1f5f9; border-radius: 8px; cursor: pointer; margin: 5px 0; transition: 0.2s; }
        .option-label:hover { background: #f8fafc; border-color: var(--primary); }
        input { width: 18px; height: 18px; margin-right: 12px; }

        /* Style cho phần Review */
        .review-q-item { margin-bottom: 30px; padding: 20px; border-radius: 12px; border: 2px solid #eee; }
        .review-opt { padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #eee; font-size: 0.95rem; }
        .opt-correct { background-color: #dcfce7; border-color: #22c55e; color: #14532d; font-weight: 500; } /* Highlight xanh cho đáp án đúng */
        .opt-wrong-choice { background-color: #fee2e2; border-color: #ef4444; color: #7f1d1d; } /* Highlight đỏ cho lựa chọn sai */
        
        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; margin-bottom: 10px; }
        .status-true { background: var(--success); color: white; }
        .status-false { background: var(--error); color: white; }

        .btn-submit { width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .result-box { display: none; text-align: center; }
        .score-val { font-size: 4rem; color: var(--primary); font-weight: bold; margin: 10px 0; }
    </style>
</head>
<body>

<div class="container">
    <div id="quiz-area">
        <div class="header">
            <h2>KIỂM TRA CÔNG NGHỆ 11</h2>
            <p>Phần I: 12 câu (Trộn 6A + 6B) | Phần II: 4 câu (P2)</p>
        </div>
        <div id="quiz-container"></div>
        <button class="btn-submit" onclick="grade()">NỘP BÀI KIỂM TRA</button>
    </div>

    <div id="result-area" class="result-box">
        <h2>KẾT QUẢ BÀI LÀM</h2>
        <div class="score-val" id="score-display">0/10</div>
        <p id="stats-display" style="font-size: 1.2rem; margin-bottom: 20px;"></p>
        <button onclick="location.reload()" style="padding:12px 25px; cursor:pointer; background: #64748b; color: white; border:none; border-radius: 6px;">Làm đề khác</button>
        <div class="section-header" style="text-align: left; margin-top: 40px;">XEM LẠI CHI TIẾT ĐÁP ÁN</div>
        <div id="review-list" style="text-align: left;"></div>
    </div>
</div>

<script>
// Dữ liệu ngân hàng câu hỏi (Giữ nguyên như cũ)
const BANK_A = [
    {q: "Vai trò của cơ khí chế tạo trong giao thông vận tải là gì?", a: ["Máy MRI", "Tưới tự động", "Động cơ ô tô, xe máy", "Máy xay lúa"], c: "Mg=="},
    {q: "Ai trực tiếp lắp đặt động cơ vào khung xe?", a: ["Công nhân lắp ráp", "Giám đốc", "Kỹ sư thiết kế", "Bảo vệ"], c: "MA=="},
    {q: "Tính chất hoá học của vật liệu cơ khí là?", a: ["Tính cứng", "Dẫn điện", "Dẫn nhiệt", "Chịu ăn mòn"], c: "Mw=="},
    {q: "Khả năng chống lại biến dạng dẻo hoặc phá hủy gọi là?", a: ["Tính dẫn nhiệt", "Tính đúc", "Độ bền", "Khối lượng riêng"], c: "Mg=="},
    {q: "Vật liệu nhớ được hình dạng ban đầu?", a: ["Cơ tính biến thiên", "Nano", "Hợp kim nhớ hình", "Kim loại"], c: "Mg=="},
    {q: "Phương pháp gia công có phoi là?", a: ["Tiện", "Đúc", "Rèn", "Hàn"], c: "MA=="},
    {q: "Ưu điểm của phương pháp hàn?", a: ["Kém bền", "Hở", "Cong vênh", "Tiết kiệm kim loại"], c: "Mw=="},
    {q: "Trên máy tiện, chi tiết gắn dao là?", a: ["Mâm cặp", "Ụ động", "Bàn gá dao", "Hộp tốc độ"], c: "Mg=="},
    {q: "Trình tự sản xuất cơ khí đúng?", a: ["Phôi -> Gia công -> Xử lý -> Lắp ráp -> Đóng gói", "Gia công -> Phôi -> Kiểm tra", "Lắp ráp -> Gia công", "Phôi -> Lắp ráp -> Đóng gói"], c: "MA=="},
    {q: "Hoạt động 'Xử lý và bảo vệ bề mặt' gồm?", a: ["Tiện, phay", "Đúc, rèn", "Sơn, mạ, phủ hóa chất", "Lắp bu lông"], c: "Mg=="}
];

const BANK_B = [
    {q: "Gia công cơ khí là quá trình gì?", a: ["Chế tạo sản phẩm cơ khí", "Nghiên cứu thông số", "Tổ hợp chi tiết", "Bảo dưỡng máy"], c: "MA=="},
    {q: "Gang là hợp kim của sắt và carbon với hàm lượng carbon?", a: ["Dưới 2.14%", "Trên 2.14%", "Bằng 0.1%", "Trên 6.67%"], c: "MQ=="},
    {q: "Đặc điểm của nhựa nhiệt dẻo?", a: ["Không tái sinh", "Nóng chảy ở nhiệt độ thấp, tái sinh được", "Dẫn điện tốt", "Rất nặng"], c: "MQ=="},
    {q: "Thép carbon thấp có tính chất gì?", a: ["Rất giòn", "Dẻo, dai nhưng độ cứng thấp", "Không thể rèn", "Dẫn nhiệt kém"], c: "MQ=="},
    {q: "Phương pháp đúc là gì?", a: ["Rót kim loại lỏng vào khuôn", "Dùng ngoại lực ép kim loại", "Cắt bỏ lớp kim loại thừa", "Nối các chi tiết bằng nhiệt"], c: "MA=="},
    {q: "Sản phẩm của gia công không phoi có đặc điểm?", a: ["Độ bóng cực cao", "Kích thước thô, cần gia công lại", "Luôn có hình trụ", "Rất nặng"], c: "MQ=="},
    {q: "Nghề nghiệp thiết kế cơ khí yêu cầu trình độ?", a: ["Sơ cấp", "Trung cấp", "Đại học trở lên", "Không cần bằng cấp"], c: "Mg=="},
    {q: "Vật liệu Nano có kích thước khoảng?", a: ["1 đến 100 nm", "1 đến 100 mm", "1 đến 100 cm", "1 m"], c: "MA=="}
];

const BANK_P2 = [
    {q: "Các phương pháp gia công không phoi bao gồm?", a: ["Đúc", "Tiện", "Rèn", "Hàn"], c: "WzAsIDIsIDNd"},
    {q: "Vật liệu kim loại bao gồm các loại nào sau đây?", a: ["Gang", "Thép", "Đồng", "Nhựa"], c: "WzAsIDEsIDJd"},
    {q: "Các tính chất của vật liệu cơ khí bao gồm?", a: ["Tính chất cơ học", "Tính chất vật lý", "Tính chất hóa học", "Tính chất tâm linh"], c: "WzAsIDEsIDJd"},
    {q: "Các loại máy công cụ phổ biến trong cơ khí là?", a: ["Máy tiện", "Máy phay", "Máy khoan", "Máy in văn phòng"], c: "WzAsIDEsIDJd"}
];

let currentExam = [];
const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);

function init() {
    const subA = shuffle([...BANK_A]).slice(0, 6);
    const subB = shuffle([...BANK_B]).slice(0, 6);
    const subP2 = shuffle([...BANK_P2]).slice(0, 4);
    const part1 = shuffle([...subA, ...subB]);
    const combined = [...part1, ...subP2];

    currentExam = combined.map(item => {
        const decodedCorrect = JSON.parse(atob(item.c));
        const isMulti = Array.isArray(decodedCorrect);
        let opts = item.a.map((txt, i) => ({
            text: txt,
            isCorrect: isMulti ? decodedCorrect.includes(i) : i === decodedCorrect
        }));
        return { title: item.q, type: isMulti ? 'multi' : 'single', options: shuffle(opts) };
    });
    render();
}

function render() {
    let html = '';
    currentExam.forEach((q, i) => {
        if(i === 0) html += `<div class="section-header">PHẦN I: TRẮC NGHIỆM 1 ĐÁP ÁN</div>`;
        if(i === 12) html += `<div class="section-header">PHẦN II: TRẮC NGHIỆM NHIỀU ĐÁP ÁN</div>`;
        html += `<div class="question-item">
            <p><strong>Câu ${i+1}: ${q.title}</strong></p>
            ${q.options.map((o, oi) => `
                <label class="option-label">
                    <input type="${q.type==='single'?'radio':'checkbox'}" name="q${i}" value="${oi}">
                    ${o.text}
                </label>
            `).join('')}
        </div>`;
    });
    document.getElementById('quiz-container').innerHTML = html;
}

function grade() {
    let score = 0;
    let reviewHtml = '';

    currentExam.forEach((q, i) => {
        const selected = Array.from(document.querySelectorAll(`input[name="q${i}"]:checked`)).map(el => parseInt(el.value));
        const correctIdxs = q.options.map((o, idx) => o.isCorrect ? idx : null).filter(v => v !== null);

        let isRight = (q.type === 'single') 
            ? (selected.length === 1 && q.options[selected[0]].isCorrect)
            : (selected.length > 0 && selected.length === correctIdxs.length && selected.every(v => correctIdxs.includes(v)));

        if(isRight) score++;

        // Tạo giao diện Review cho từng câu
        reviewHtml += `<div class="review-q-item" style="border-color: ${isRight ? '#dcfce7' : '#fee2e2'}">
            <span class="status-badge ${isRight ? 'status-true' : 'status-false'}">
                ${isRight ? 'ĐÚNG' : 'SAI'}
            </span>
            <p><strong>Câu ${i+1}: ${q.title}</strong></p>
            <div>
                ${q.options.map((opt, optIdx) => {
                    let className = 'review-opt';
                    let marker = '';
                    
                    if (opt.isCorrect) {
                        className += ' opt-correct'; // Luôn highlight xanh đáp án đúng
                        marker = ' (Đáp án đúng)';
                    }
                    if (selected.includes(optIdx) && !opt.isCorrect) {
                        className += ' opt-wrong-choice'; // Highlight đỏ nếu học sinh chọn sai
                        marker = ' (Lựa chọn của bạn - Sai)';
                    }
                    if (selected.includes(optIdx) && opt.isCorrect) {
                        marker = ' (Lựa chọn của bạn - Đúng)';
                    }

                    return `<div class="${className}">${opt.text} ${marker}</div>`;
                }).join('')}
            </div>
        </div>`;
    });

    const finalScore = (score / currentExam.length) * 10;
    document.getElementById('quiz-area').style.display = 'none';
    document.getElementById('result-area').style.display = 'block';
    document.getElementById('score-display').innerText = finalScore.toFixed(1) + "/10";
    document.getElementById('stats-display').innerText = `Kết quả: Đúng ${score} câu trên tổng số ${currentExam.length} câu.`;
    document.getElementById('review-list').innerHTML = reviewHtml;
    window.scrollTo(0,0);
}

window.onload = init;
</script>
</body>
</html>
